(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{yi:()=>N,Hk:()=>H});var t=document.querySelectorAll(".popup__close"),n=document.querySelector(".profile__edit-btn"),o=document.querySelector("#profile__avatar-update-button"),r=document.querySelector(".profile__add-btn"),c=(document.querySelector("#cardPopupCloseBtn"),document.querySelector("#cardSubmitBtn")),u=document.querySelector(".popup__form"),a=u.querySelector("#popup__input-name"),s=u.querySelector("#popup__input-status"),i=document.querySelector(".profile__name"),l=document.querySelector(".profile__status"),d=document.querySelector(".profile__avatar"),p=document.querySelector("#profile-btn-submit"),f=document.querySelector("#popup-update-avatar"),m=document.querySelector("#url-avatar-input"),v=document.querySelector("#update-avatar"),_=(document.querySelector("#popupformCard"),document.querySelector(".elements")),h=document.querySelector("#cardTemplate").content.querySelector(".elements__element"),y=document.querySelector("#popup__input-cardname"),S=document.querySelector("#popup__input-cardsrc"),b=document.querySelector("#popup-img"),q=document.querySelector(".img-popup__img"),g=document.querySelector(".img-popup__caption"),E=document.querySelector("#popup-profile"),L=document.querySelector("#popup-card"),k=(u.querySelector(".popup__input"),document.querySelectorAll(".popup")),C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input_error_active"};function j(e){e.classList.add("popup_opened"),document.addEventListener("keydown",P),k.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&x(e)}))}))}function x(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",P)}function P(e){"Escape"===e.key&&x(document.querySelector(".popup_opened"))}function U(e,t,n){t.textContent=e?"Сохранение...":n}var A={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"5e97ff51-83fb-4a87-a9ba-ca3be6f4f066","Content-Type":"application/json"}};function T(e,t){return fetch("".concat(A.baseUrl,"/cards"),{method:"POST",headers:A.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){U(!1,c,"Создать")})).catch((function(e){console.log(e)}))}function B(e,t){t.prepend(e)}function D(e,t,n,o,r){var c=h.cloneNode(!0),u=c.querySelector(".elements__title"),a=c.querySelector(".elements__image"),s=c.querySelector(".elements__delete-btn"),i=c.querySelector(".elements__heart-btn"),l=c.querySelector(".elements__heart-btn-count");return console.log(r),a.src=t,a.id=n,a.alt=e,u.textContent=e,l.textContent=o,i.addEventListener("click",(function(e){e.target.classList.contains("elements__heart-btn_active")?(e.target.classList.remove("elements__heart-btn_active"),function(e,t){fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}(n,l)):(e.target.classList.add("elements__heart-btn_active"),function(e,t){fetch("".concat(A.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.textContent=e.likes.length})).catch((function(e){console.log(e)}))}(n,l))})),"8fb1ea325510c052bd2c5531"===r&&(s.style.display="block",s.addEventListener("click",(function(e){e.target.closest(".elements__element").remove(c),function(e){fetch("".concat(A.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}(n)}))),a.addEventListener("click",(function(n){j(b),q.src=t,g.textContent=e,q.alt=e})),c}var O=function(e,t){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"_error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,C):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"_error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,C)},w=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),u.addEventListener("submit",N),f.addEventListener("submit",H),c.addEventListener("click",(function(e){e.preventDefault(),B(D(y.value,S.value),_),T(y.value,S.value),x(L)}))):(t.classList.add(n.inactiveButtonClass),u.removeEventListener("submit",N),f.removeEventListener("submit",H),c.removeEventListener("click",(function(e){e.preventDefault(),B(D(y.value,S.value),_),T(y.value,S.value),x(L)})))};function N(e){e.preventDefault(),i.textContent=a.value,l.textContent=s.value,function(e,t){fetch("".concat(A.baseUrl,"/users/me"),{method:"PATCH",headers:A.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():(console.log("2"),Promise.reject("Ошибка: ".concat(e.status)))})).then((function(e){U(!1,p,"Сохранить"),console.log(e)})).catch((function(e){console.log(e)}))}(i.textContent,l.textContent),x(E)}function H(e){var t;e.preventDefault(),d.src=m.value,t=d.src,fetch("".concat(A.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:A.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){U(!1,v,"Сохранить"),console.log(e)})).catch((function(e){console.log(e)})),x(f)}t.forEach((function(e){return e.addEventListener("click",(function(e){return x(e.target.closest(".popup"))}))})),n.addEventListener("click",(function(){j(E),a.value=i.textContent,s.value=l.textContent})),o.addEventListener("click",(function(){console.log("avatar"),j(f)})),r.addEventListener("click",(function(){y.value="",S.value="",j(L)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);w(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){O(e,r),w(n,o,t)}))}))}(t,e)}))}(C),fetch("".concat(A.baseUrl,"/users/me"),{headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){i.textContent=e.name,l.textContent=e.about,d.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(A.baseUrl,"/cards"),{headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=D(e.name,e.link,e._id,e.likes.length,e.owner._id);console.log(t),B(t,_)}))})).catch((function(e){console.log(e)}))})();